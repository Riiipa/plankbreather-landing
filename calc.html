<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор Інвестора (LMNP)</title>
    
    <!-- Підключення Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Підключення React та ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel для обробки JSX прямо в браузері -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background-color: #f3f4f6; padding: 20px; font-family: sans-serif; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ІКОНКИ (SVG Components замість lucide-react для роботи без збірки) ---
        const IconWrapper = ({ children, color = "currentColor", size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Home = (props) => <IconWrapper {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconWrapper>;
        const Calculator = (props) => <IconWrapper {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></IconWrapper>;
        const Euro = (props) => <IconWrapper {...props}><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2"/></IconWrapper>;
        const TrendingUp = (props) => <IconWrapper {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconWrapper>;
        const Info = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconWrapper>;
        const Users = (props) => <IconWrapper {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconWrapper>;
        const Wallet = (props) => <IconWrapper {...props}><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></IconWrapper>;
        const PieChart = (props) => <IconWrapper {...props}><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10Z"/></IconWrapper>;
        const Banknote = (props) => <IconWrapper {...props}><rect width="20" height="12" x="2" y="6" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></IconWrapper>;
        const LineChart = (props) => <IconWrapper {...props}><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></IconWrapper>;
        const AlertCircle = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconWrapper>;


        // --- ГОЛОВНИЙ КОМПОНЕНТ ---
        const RealEstateCalculator = () => {
            // --- STATE: Вхідні дані ---
            
            // 1. Об'єкт
            const [price, setPrice] = useState(150000);
            const [area, setArea] = useState(19);
            const [works, setWorks] = useState(10000); 
            
            // 2. Фінансування
            const [contribution, setContribution] = useState(25000); 
            const [rate, setRate] = useState(3.7); 
            const [duration, setDuration] = useState(20); 
            const [insuranceRate, setInsuranceRate] = useState(0.35); 

            // 3. Експлуатація
            const [rent, setRent] = useState(750); 
            const [chargesCopro, setChargesCopro] = useState(70); 
            const [taxeFonciere, setTaxeFonciere] = useState(600); 
            const [pno, setPno] = useState(150); 
            const [accountant, setAccountant] = useState(250); 
            const [vacancyRate, setVacancyRate] = useState(5); 

            // 4. Альтернативні інвестиції
            const [sp500Rate, setSp500Rate] = useState(8); 
            const [techRate, setTechRate] = useState(12); 

            // --- РОЗРАХУНКИ ---
            const notaryFees = price * 0.08; 
            const totalProjectCost = price + works + notaryFees;
            const loanAmount = totalProjectCost - contribution;

            // Кредит
            const monthlyRate = rate / 100 / 12;
            const numberOfPayments = duration * 12;
            const monthlyMortgage = loanAmount > 0 
                ? (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1) 
                : 0;
            
            const monthlyInsurance = (loanAmount * (insuranceRate / 100)) / 12;
            const totalMonthlyLoan = monthlyMortgage + monthlyInsurance;

            // Витрати щомісячні
            const monthlyTaxeFonciere = taxeFonciere / 12;
            const monthlyPNO = pno / 12;
            const monthlyAccountant = accountant / 12;
            const monthlyVacancy = rent * (vacancyRate / 100);
            const managementFee = 0; 

            const totalMonthlyExpenses = chargesCopro + monthlyTaxeFonciere + monthlyPNO + monthlyAccountant + managementFee + monthlyVacancy;
            const totalOutflow = totalMonthlyLoan + totalMonthlyExpenses;
            const cashFlow = rent - totalOutflow;

            // --- LIFETIME ---
            const totalMonths = duration * 12;
            const totalTenantPaid = (rent - monthlyVacancy) * totalMonths;
            const monthlyExpensesRealCash = chargesCopro + monthlyTaxeFonciere + monthlyPNO + monthlyAccountant + managementFee;
            const totalLifetimeCost = contribution + (totalMonthlyLoan * totalMonths) + (monthlyExpensesRealCash * totalMonths);
            const totalInvestorPaid = totalLifetimeCost - totalTenantPaid;
            const totalLoanRepayment = totalMonthlyLoan * totalMonths;
            const costOfCredit = totalLoanRepayment - loanAmount;

            const percentTenant = Math.min(100, Math.max(0, (totalTenantPaid / totalLifetimeCost) * 100));
            const percentInvestor = 100 - percentTenant;
            const grossYield = (rent * 12 / totalProjectCost) * 100;

            // --- ALTERNATIVE INVESTMENTS ---
            const monthlyInvestAlternative = Math.max(0, -cashFlow); 
            
            const calculateCompoundInterest = (principal, monthly, rate, years) => {
                const r = rate / 100 / 12;
                const n = years * 12;
                const futureValuePrincipal = principal * Math.pow(1 + r, n);
                const futureValueSeries = monthly * (Math.pow(1 + r, n) - 1) / r;
                return futureValuePrincipal + futureValueSeries;
            };

            const finalValueSP500 = calculateCompoundInterest(contribution, monthlyInvestAlternative, sp500Rate, duration);
            const finalValueTech = calculateCompoundInterest(contribution, monthlyInvestAlternative, techRate, duration);
            const realEstateAppreciationRate = 2; 
            const finalValueRealEstate = price * Math.pow(1 + (realEstateAppreciationRate/100), duration);

            return (
                <div className="max-w-4xl mx-auto p-4 bg-gray-50 rounded-xl font-sans text-gray-800 shadow-xl">
                    <div className="flex items-center gap-2 mb-6 border-b pb-4 border-gray-200">
                        <Home className="text-blue-600 w-8 h-8" />
                        <div>
                        <h1 className="text-2xl font-bold text-gray-900">Калькулятор Інвестора (LMNP)</h1>
                        <p className="text-sm text-gray-500">Симуляція: Нерухомість vs Акції</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        {/* ЛІВА КОЛОНКА */}
                        <div className="space-y-6">
                            <div className="bg-white p-5 rounded-lg shadow-sm border border-gray-100">
                                <h3 className="text-md font-semibold text-blue-800 mb-4 flex items-center gap-2">
                                <Calculator size={18}/> Вартість Проекту
                                </h3>
                                <div className="space-y-3">
                                <div>
                                    <label className="text-xs font-medium text-gray-500 uppercase">Ціна квартири (€)</label>
                                    <input type="number" value={price} onChange={(e) => setPrice(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none transition"/>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    <div>
                                    <label className="text-xs font-medium text-gray-500 uppercase">Ремонт/Меблі (€)</label>
                                    <input type="number" value={works} onChange={(e) => setWorks(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md"/>
                                    </div>
                                    <div>
                                    <label className="text-xs font-medium text-gray-500 uppercase">Нотаріус (8%)</label>
                                    <div className="w-full mt-1 p-2 bg-gray-100 rounded-md text-gray-600">{notaryFees.toLocaleString()} €</div>
                                    </div>
                                </div>
                                <div className="pt-2 border-t flex justify-between items-center">
                                    <span className="font-semibold text-sm">Повна вартість:</span>
                                    <span className="font-bold text-lg text-blue-900">{totalProjectCost.toLocaleString()} €</span>
                                </div>
                                </div>
                            </div>

                            <div className="bg-white p-5 rounded-lg shadow-sm border border-gray-100">
                                <h3 className="text-md font-semibold text-blue-800 mb-4 flex items-center gap-2"><Euro size={18}/> Фінансування</h3>
                                <div className="space-y-3">
                                <div>
                                    <label className="text-xs font-medium text-gray-500 uppercase">Ваш внесок (Apport) (€)</label>
                                    <input type="number" value={contribution} onChange={(e) => setContribution(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none"/>
                                </div>
                                <div className="grid grid-cols-3 gap-3">
                                    <div className="col-span-1">
                                    <label className="text-xs font-medium text-gray-500 uppercase">Ставка %</label>
                                    <input type="number" step="0.01" value={rate} onChange={(e) => setRate(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md"/>
                                    </div>
                                    <div className="col-span-1">
                                    <label className="text-xs font-medium text-gray-500 uppercase">Років</label>
                                    <input type="number" value={duration} onChange={(e) => setDuration(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md"/>
                                    </div>
                                    <div className="col-span-1">
                                    <label className="text-xs font-medium text-gray-500 uppercase">Страховка %</label>
                                    <input type="number" step="0.01" value={insuranceRate} onChange={(e) => setInsuranceRate(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md"/>
                                    </div>
                                </div>
                                <div className="p-3 bg-blue-50 rounded-md flex justify-between items-center border border-blue-100">
                                    <span className="text-sm text-blue-800 font-medium">Кредитний платіж:</span>
                                    <span className="font-bold text-blue-900">{totalMonthlyLoan.toFixed(0)} €/міс</span>
                                </div>
                                </div>
                            </div>

                            <div className="bg-white p-5 rounded-lg shadow-sm border border-gray-100">
                                <h3 className="text-md font-semibold text-blue-800 mb-4 flex items-center gap-2"><TrendingUp size={18}/> Операційна діяльність</h3>
                                <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs font-medium text-green-600 uppercase">Оренда (на місяць)</label>
                                    <input type="number" value={rent} onChange={(e) => setRent(Number(e.target.value))} className="w-full mt-1 p-2 border border-green-200 bg-green-50 rounded-md font-semibold text-green-800"/>
                                </div>
                                <div>
                                    <label className="text-xs font-medium text-red-500 uppercase">Комунальні (Charges)</label>
                                    <input type="number" value={chargesCopro} onChange={(e) => setChargesCopro(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md"/>
                                </div>
                                <div>
                                    <label className="text-xs font-medium text-red-500 uppercase">Taxe Foncière (рік)</label>
                                    <input type="number" value={taxeFonciere} onChange={(e) => setTaxeFonciere(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md"/>
                                </div>
                                <div>
                                    <label className="text-xs font-medium text-red-500 uppercase">Інше (PNO/Бух) рік</label>
                                    <input type="number" value={pno + accountant} onChange={(e) => setPno(Number(e.target.value))} className="w-full mt-1 p-2 border rounded-md"/>
                                </div>
                                </div>
                            </div>
                        </div>

                        {/* ПРАВА КОЛОНКА */}
                        <div className="space-y-6">
                            <div className={`p-6 rounded-xl shadow-md text-white ${cashFlow >= 0 ? 'bg-green-600' : 'bg-slate-800'}`}>
                                <h2 className="text-sm font-medium opacity-80 uppercase tracking-wider mb-1">Щомісячний Cash Flow</h2>
                                <div className="flex items-baseline gap-2">
                                <span className="text-5xl font-bold">{cashFlow > 0 ? '+' : ''}{cashFlow.toFixed(0)} €</span>
                                <span className="text-lg opacity-80">/ міс</span>
                                </div>
                                <p className="mt-4 text-sm opacity-90 flex items-start gap-2">
                                <Info size={16} className="mt-1 flex-shrink-0" />
                                {cashFlow < 0 ? "Це ваша доплата щомісяця (Effort d'épargne)." : "Вітаємо! Квартира окупає себе сама."}
                                </p>
                            </div>

                            <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                <h3 className="text-lg font-bold text-gray-800 mb-4">Куди йдуть гроші (щомісяця)</h3>
                                <div className="space-y-3">
                                <div className="flex justify-between items-center pb-2 border-b border-gray-100">
                                    <span className="text-green-700 font-semibold">Оренда (Дохід)</span>
                                    <span className="text-green-700 font-bold">+ {rent} €</span>
                                </div>
                                <div className="flex justify-between items-center text-sm"><span className="text-gray-600 pl-2 border-l-2 border-blue-500">Кредит + Страховка</span><span className="text-red-500 font-medium">- {totalMonthlyLoan.toFixed(0)} €</span></div>
                                <div className="flex justify-between items-center text-sm"><span className="text-gray-600 pl-2 border-l-2 border-orange-400">Комунальні + Податки</span><span className="text-red-500 font-medium">- {(chargesCopro + monthlyTaxeFonciere).toFixed(0)} €</span></div>
                                <div className="flex justify-between items-center text-sm"><span className="text-gray-600 pl-2 border-l-2 border-yellow-400">Резерв (Простій + Ремонт)</span><span className="text-red-500 font-medium">- {(monthlyVacancy + rent*0.05).toFixed(0)} €</span></div>
                                <div className="pt-3 mt-2 border-t flex justify-between items-center font-bold"><span className="text-gray-800">Всього витрат</span><span className="text-red-600">- {totalOutflow.toFixed(0)} €</span></div>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-blue-50 p-4 rounded-lg text-center"><div className="text-xs text-blue-600 uppercase font-semibold mb-1">Брутто прибутковість</div><div className="text-2xl font-bold text-blue-900">{grossYield.toFixed(2)}%</div></div>
                                <div className="bg-purple-50 p-4 rounded-lg text-center"><div className="text-xs text-purple-600 uppercase font-semibold mb-1">Кредитне плече</div><div className="text-2xl font-bold text-purple-900">{((loanAmount/totalProjectCost)*100).toFixed(0)}%</div></div>
                            </div>
                        </div>
                    </div>

                    {/* ПІДСУМОК ЗА ВЕСЬ ЧАС */}
                    <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mb-8">
                        <div className="bg-gray-900 p-4 flex items-center gap-3"><PieChart className="text-green-400" /><h2 className="text-white text-lg font-bold">Підсумок за {duration} років</h2></div>
                        <div className="p-6 grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                        <div className="md:col-span-1 flex flex-col items-center justify-center">
                            <div className="w-full h-8 bg-blue-900 rounded-full overflow-hidden flex relative shadow-inner">
                                <div className="h-full bg-green-500 flex items-center justify-center text-xs font-bold text-white transition-all duration-1000" style={{ width: `${percentTenant}%` }}>{percentTenant.toFixed(0)}%</div>
                                <div className="h-full flex items-center justify-center text-xs font-bold text-white flex-1">{percentInvestor.toFixed(0)}%</div>
                            </div>
                            <div className="flex justify-between w-full mt-2 text-sm font-semibold"><span className="text-green-600">Орендар</span><span className="text-blue-900">Ви</span></div>
                        </div>
                        <div className="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div className="p-4 bg-green-50 rounded-lg border border-green-100 relative"><div className="absolute top-4 right-4 text-green-200"><Users size={24} /></div><p className="text-xs text-green-600 uppercase font-bold">Оплачено Орендарем</p><p className="text-2xl font-bold text-green-800 mt-1">{totalTenantPaid.toLocaleString()} €</p></div>
                            <div className="p-4 bg-blue-50 rounded-lg border border-blue-100 relative"><div className="absolute top-4 right-4 text-blue-200"><Wallet size={24} /></div><p className="text-xs text-blue-600 uppercase font-bold">Оплачено Вами</p><p className="text-2xl font-bold text-blue-900 mt-1">{totalInvestorPaid.toLocaleString()} €</p></div>
                            <div className="col-span-1 sm:col-span-2 mt-2 p-4 bg-red-50 rounded-lg border border-red-100 relative"><div className="flex gap-4 items-center"><div className="p-2 bg-red-100 rounded-full text-red-600 hidden sm:block"><Banknote size={24} /></div><div><p className="text-sm font-semibold text-red-800 mb-1">Переплата банку</p><p className="text-xs text-gray-600 mb-2">За {duration} років ви заплатите <span className="font-bold text-red-700">{costOfCredit.toLocaleString()} €</span> відсотків.</p></div></div></div>
                        </div>
                        </div>
                    </div>

                    {/* БИТВА СТРАТЕГІЙ */}
                    <div className="bg-gradient-to-br from-indigo-900 to-slate-900 rounded-xl shadow-lg border border-indigo-800 overflow-hidden">
                        <div className="p-6 border-b border-indigo-800 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div><h2 className="text-white text-xl font-bold flex items-center gap-2"><LineChart className="text-yellow-400" />Битва Стратегій: Через {duration} років</h2><p className="text-indigo-200 text-sm mt-1">Альтернатива: {contribution.toLocaleString()}€ + {monthlyInvestAlternative.toFixed(0)}€/міс в акції</p></div>
                        <div className="flex gap-4 text-xs">
                            <div><label className="text-indigo-300 block mb-1">S&P500 %</label><input type="number" value={sp500Rate} onChange={e => setSp500Rate(Number(e.target.value))} className="bg-indigo-950 text-white border border-indigo-700 rounded p-1 w-20 text-center"/></div>
                            <div><label className="text-indigo-300 block mb-1">Tech %</label><input type="number" value={techRate} onChange={e => setTechRate(Number(e.target.value))} className="bg-indigo-950 text-white border border-indigo-700 rounded p-1 w-20 text-center"/></div>
                        </div>
                        </div>
                        
                        <div className="p-8">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 items-end h-64">
                            <div className="flex flex-col justify-end h-full group"><div className="text-center mb-2"><span className="text-indigo-200 text-sm font-semibold uppercase tracking-wider block mb-1">Нерухомість</span><span className="text-white text-2xl font-bold">{finalValueRealEstate.toLocaleString(undefined, {maximumFractionDigits: 0})} €</span></div><div className="w-full bg-blue-600 rounded-t-lg relative transition-all duration-500 hover:bg-blue-500" style={{height: `${(finalValueRealEstate / Math.max(finalValueRealEstate, finalValueSP500, finalValueTech)) * 100}%`}}></div></div>
                            <div className="flex flex-col justify-end h-full group"><div className="text-center mb-2"><span className="text-indigo-200 text-sm font-semibold uppercase tracking-wider block mb-1">S&P 500</span><span className="text-white text-2xl font-bold">{finalValueSP500.toLocaleString(undefined, {maximumFractionDigits: 0})} €</span></div><div className="w-full bg-yellow-500 rounded-t-lg relative transition-all duration-500 hover:bg-yellow-400" style={{height: `${(finalValueSP500 / Math.max(finalValueRealEstate, finalValueSP500, finalValueTech)) * 100}%`}}></div></div>
                            <div className="flex flex-col justify-end h-full group"><div className="text-center mb-2"><span className="text-indigo-200 text-sm font-semibold uppercase tracking-wider block mb-1">Акції</span><span className="text-white text-2xl font-bold">{finalValueTech.toLocaleString(undefined, {maximumFractionDigits: 0})} €</span></div><div className="w-full bg-purple-600 rounded-t-lg relative transition-all duration-500 hover:bg-purple-500" style={{height: `${(finalValueTech / Math.max(finalValueRealEstate, finalValueSP500, finalValueTech)) * 100}%`}}></div></div>
                        </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RealEstateCalculator />);
    </script>
</body>
</html>
